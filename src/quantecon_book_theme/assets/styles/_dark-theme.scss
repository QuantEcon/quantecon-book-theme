/*
-----------------------------------
DARK THEME STYLES
Modern dark mode overrides using a consistent color palette.
Palette:
  --qe-dark-bg:          #1a1a2e   Deep navy-charcoal background
  --qe-dark-surface:     #252540   Elevated surface (cards, sidebars)
  --qe-dark-surface-alt: #2d2d4a   Alternate surface (toolbar, inputs)
  --qe-dark-border:      #3a3a5c   Subtle borders
  --qe-dark-text:        #d4d4e4   Primary text (soft white)
  --qe-dark-text-muted:  #9898b0   Secondary/muted text
  --qe-dark-link:        #6cb6ff   Links (GitHub-style blue)
  --qe-dark-link-hover:  #91cdff   Link hover
  --qe-dark-code-bg:     #1e1e32   Code block background
  --qe-dark-accent:      #0072bc   Theme primary accent (carried from light)
-----------------------------------
*/

@use "colors";

body.dark-theme {
  // =========================================
  // CSS CUSTOM PROPERTIES (overridable by downstream projects)
  // =========================================
  --qe-dark-bg:          #1a1a2e;
  --qe-dark-surface:     #252540;
  --qe-dark-surface-alt: #2d2d4a;
  --qe-dark-border:      #3a3a5c;
  --qe-dark-text:        #d4d4e4;
  --qe-dark-text-muted:  #9898b0;
  --qe-dark-heading:     #e8e8f0;
  --qe-dark-heading-top: #f0f0f8;
  --qe-dark-text-light:  #b8b8d0;
  --qe-dark-link:        #6cb6ff;
  --qe-dark-link-hover:  #91cdff;
  --qe-dark-link-visited:#a08fff;
  --qe-dark-code-bg:     #1e1e32;
  --qe-dark-inline-code: #e0b0ff;
  --qe-dark-accent:      #0072bc;
  --qe-dark-accent-dark: #005a96;

  // =========================================
  // BASE: Body, text, headings
  // =========================================
  background-color: var(--qe-dark-bg);
  color: var(--qe-dark-text);

  h1,
  h2,
  h3,
  h4,
  h5 {
    color: var(--qe-dark-heading);
  }

  h1 {
    color: var(--qe-dark-heading-top);
  }

  p {
    color: var(--qe-dark-text);
  }

  // =========================================
  // PAGE HEADER: Title, authors, changelog
  // =========================================
  .qe-page__header {
    &-heading a {
      color: var(--qe-dark-heading-top);
    }

    &-authors {
      color: var(--qe-dark-text);
    }

    &-changed {
      color: var(--qe-dark-text-muted);
      border-bottom-color: var(--qe-dark-accent);

      &:hover {
        background: rgba(255, 255, 255, 0.05);
      }
    }

    &-changelog {
      background: var(--qe-dark-surface);
      border-left-color: var(--qe-dark-border);
      border-right-color: var(--qe-dark-border);
      border-bottom-color: var(--qe-dark-border);

      h4 {
        color: var(--qe-dark-heading);

        a {
          color: var(--qe-dark-link);
        }
      }

      .changelog-entry {
        border-bottom-color: var(--qe-dark-border);
      }

      .changelog-hash {
        color: var(--qe-dark-text-muted);

        &:hover {
          color: var(--qe-dark-link);
        }
      }

      .changelog-author {
        color: var(--qe-dark-text);
      }

      .changelog-time {
        color: var(--qe-dark-text-muted);
      }

      .changelog-message {
        color: var(--qe-dark-text);
      }
    }
  }

  // =========================================
  // LINKS: Distinguishable, accessible
  // =========================================
  a {
    color: var(--qe-dark-link);

    &:hover {
      color: var(--qe-dark-link-hover);
    }

    &:visited {
      color: var(--qe-dark-link-visited);
    }
  }

  .reference.external,
  .reference.internal {
    color: var(--qe-dark-link);
    font-weight: 600;

    &:hover {
      color: var(--qe-dark-link-hover);
    }
  }

  // =========================================
  // EMPHASIS / STRONG / DEFINITION COLORS
  // =========================================
  em {
    color: var(--qe-emphasis-color, colors.$emphasis-dark);
  }

  strong,
  b {
    color: var(--qe-strong-color, colors.$definition-dark);
  }

  dl.simple dt,
  dl.glossary dt,
  dl.field-list dt {
    color: var(--qe-definition-color, var(--qe-strong-color, colors.$definition-dark));
  }

  // =========================================
  // INLINE CODE
  // =========================================
  cite,
  code,
  tt {
    background-color: var(--qe-dark-surface);
    border-color: var(--qe-dark-border);
    color: var(--qe-dark-inline-code);
  }

  // =========================================
  // TOOLBAR
  // =========================================
  .qe-toolbar {
    background-color: var(--qe-dark-surface);
    border-bottom-color: var(--qe-dark-border);
  }

  .qe-toolbar__inner > ul > li > a {
    color: var(--qe-dark-text);
  }

  .qe-toolbar__inner > ul > li.btn__search input {
    background-color: var(--qe-dark-code-bg);
    color: var(--qe-dark-text);
    border-color: var(--qe-dark-border);

    &:focus {
      border-color: var(--qe-dark-link);
    }
  }

  .qe-toolbar__inner > ul > li.btn__qelogo a {
    filter: brightness(0) invert(1) opacity(0.85);
  }

  .btn__search input {
    background-color: var(--qe-dark-code-bg);
    color: var(--qe-dark-text);

    &:focus {
      border-color: var(--qe-dark-link);
    }
  }

  // =========================================
  // LEFT SIDEBAR
  // =========================================
  .qe-sidebar {
    background-color: var(--qe-dark-surface);
    border-right-color: var(--qe-dark-border);

    @media (max-width: 1340px) {
      box-shadow: 10px 10px 5px 9999px rgba(0, 0, 0, 0.6);
    }
  }

  .qe-sidebar__nav ul > li > a {
    color: var(--qe-dark-text-light);

    &.active {
      color: var(--qe-dark-link);
    }
  }

  .drawer,
  .drawer .inner {
    background-color: var(--qe-dark-surface);
  }

  // Sidebar search area
  .bd-search {
    background-color: var(--qe-dark-code-bg);

    .form-control {
      background: var(--qe-dark-surface);
      border-color: var(--qe-dark-border);
      color: var(--qe-dark-text);
    }

    svg {
      color: var(--qe-dark-text-muted);
    }
  }

  // =========================================
  // RIGHT TOC ("On this page")
  // =========================================
  .qe-page__toc {
    &-nav {
      ul li a {
        color: var(--qe-dark-text-muted);

        &.active {
          color: var(--qe-dark-link);
        }
      }

      ul li.active > a {
        color: var(--qe-dark-link);
      }

      // Copy-link icon
      ul li a .toc-copy-link {
        color: var(--qe-dark-text-muted);

        &:hover {
          color: var(--qe-dark-link);
        }
      }
    }
  }

  .toc-entry a.nav-link {
    color: var(--qe-dark-text-muted);
  }

  // Back to top button
  .back-to-top-btn {
    color: var(--qe-dark-link);

    &:hover {
      color: var(--qe-dark-link-hover);
    }
  }

  // =========================================
  // LOGO HANDLING
  // =========================================
  .logo-img {
    display: none;
  }

  .dark-logo-img {
    display: block;
  }

  // Fallback: when no dedicated dark logo is provided, show the light
  // logo with an inversion filter. We check :only-child on the <a>
  // wrapper (not the <img>) because each <img> is always the sole
  // child of its own <a>. When a dark logo IS configured there are
  // two <a> siblings, so :only-child won't match.
  p.logo > a:only-child > .logo-img,
  .qe-sidebar__nav .logo > a:only-child > img {
    display: block;
    filter: invert(100%) hue-rotate(-180deg);
    -webkit-filter: invert(100%) hue-rotate(-180deg);
  }

  // =========================================
  // CODE BLOCKS & SYNTAX HIGHLIGHTING
  // =========================================
  .highlight {
    background: var(--qe-dark-code-bg) !important;
    border-color: var(--qe-dark-border) !important;
  }

  .highlight-none .highlight {
    background: transparent !important;
    border: 0 !important;
  }

  pre {
    background-color: var(--qe-dark-code-bg);
    color: var(--qe-dark-text);
  }

  // =========================================
  // TABLES
  // =========================================
  .qe-page__content table {
    tbody tr:nth-child(odd) {
      background-color: var(--qe-dark-surface);
    }

    tbody tr:nth-child(even) {
      background-color: transparent;
    }

    td,
    th {
      color: var(--qe-dark-text);
    }

    td > p,
    th > p {
      color: var(--qe-dark-text);
    }

    thead th,
    thead td {
      border-bottom-color: var(--qe-dark-border);
      color: var(--qe-dark-heading);
    }
  }

  // =========================================
  // ADMONITIONS
  // =========================================
  div.admonition,
  .admonition {
    background-color: var(--qe-dark-surface);
    box-shadow: none;
    border: 1px solid var(--qe-dark-border);

    > .admonition-title {
      background-color: rgba(108, 182, 255, 0.1);
    }
  }

  // Type-specific admonition accent colors
  .admonition.warning,
  .admonition.caution,
  .admonition.attention {
    border-color: #d4a017;

    > .admonition-title {
      background-color: rgba(212, 160, 23, 0.12);
    }
  }

  .admonition.danger,
  .admonition.error {
    border-color: #e06060;

    > .admonition-title {
      background-color: rgba(224, 96, 96, 0.12);
    }
  }

  .admonition.tip,
  .admonition.hint {
    border-color: #50b880;

    > .admonition-title {
      background-color: rgba(80, 184, 128, 0.12);
    }
  }

  .admonition.important {
    border-color: var(--qe-dark-link);

    > .admonition-title {
      background-color: rgba(108, 182, 255, 0.12);
    }
  }

  // =========================================
  // BLOCKQUOTES
  // =========================================
  blockquote {
    border-left-color: var(--qe-dark-link);
    color: var(--qe-dark-text);

    p {
      color: var(--qe-dark-text);
    }
  }

  // =========================================
  // MATH (MathJax / KaTeX)
  // =========================================
  .maths,
  .math {
    color: var(--qe-dark-text) !important;
  }

  .qe-page__content .MathJax {
    color: var(--qe-dark-text) !important;
  }

  .qe-page__content a .MathJax,
  .qe-page__content a .math {
    color: var(--qe-dark-link) !important;
  }

  mjx-math mjx-mstyle {
    color: var(--qe-dark-text) !important;
  }

  // =========================================
  // IMAGES: Subtle brightness reduction instead of aggressive inversion
  // Only invert SVG line art; leave photos/plots natural
  // =========================================
  .qe-page__content {
    .image-reference img,
    figure img,
    .cell_output img {
      opacity: 0.88;
      transition: opacity 0.2s ease;

      &:hover {
        opacity: 1;
      }
    }
  }

  // Inline SVG icons adapt to text color (scoped to UI icons, not charts/plots)
  .qe-toolbar svg g,
  .qe-sidebar svg g,
  .topbar-main svg g,
  nav svg g {
    fill: currentColor !important;
    stroke: currentColor !important;
  }

  // =========================================
  // CELLS (Jupyter notebook)
  // =========================================
  div.cell div.cell_input {
    background-color: var(--qe-dark-code-bg);
    border-left-color: var(--qe-dark-link);
  }

  div.cell details.below-input > summary,
  div.cell details.above-input > summary {
    background-color: var(--qe-dark-surface);
  }

  .cell_output .output.text_plain,
  .cell_output .output.stream,
  .cell_output .output.stderr {
    border: 0;
  }

  .cell .input .prompt:before {
    color: var(--qe-dark-link);
  }

  // Copy button
  .qe-page__content a.copybtn {
    color: var(--qe-dark-text-muted);

    &:hover {
      color: var(--qe-dark-text);
    }
  }

  // =========================================
  // TOPICS, CONTENTS NAV, SIDEBAR PANELS
  // =========================================
  aside.topic,
  div.topic,
  div.topic.contents,
  nav.contents {
    background-color: var(--qe-dark-surface);
    border-color: var(--qe-dark-border);
    box-shadow: none;
  }

  aside.sidebar {
    background-color: var(--qe-dark-surface);
  }

  // =========================================
  // COLLAPSE / TOGGLE BARS
  // =========================================
  div[class^="cell tag_collapse"] .collapse-toggle-bar {
    background-color: var(--qe-dark-surface);
    border-color: var(--qe-dark-border);

    &:hover {
      background-color: var(--qe-dark-surface-alt);
    }

    .collapse-indicator {
      color: var(--qe-dark-link);
    }
  }

  button.toggle-button.toggle-button-hidden::before {
    color: var(--qe-dark-text);
  }

  // =========================================
  // CONTENT TOC (in-page)
  // =========================================
  .qe-page__content #contents + ul {
    border-color: var(--qe-dark-border) !important;
  }

  // =========================================
  // ANCHOR / HEADER LINKS
  // =========================================
  .qe-page__content .anchor-link,
  .qe-page__content .headerlink {
    color: var(--qe-dark-text-muted);

    &:hover {
      color: var(--qe-dark-link);
    }
  }

  // =========================================
  // TIPPY TOOLTIPS
  // =========================================
  .tippy-box {
    background-color: var(--qe-dark-surface-alt);
    color: var(--qe-dark-text);
    border: 1px solid var(--qe-dark-border);
  }

  .tippy-box .tippy-arrow {
    color: var(--qe-dark-surface-alt);
  }

  // =========================================
  // MODALS
  // =========================================
  #downloadPDFModal {
    background-color: var(--qe-dark-surface);
    color: var(--qe-dark-text);

    p {
      color: var(--qe-dark-link);
    }
  }

  #settingsModal {
    background-color: var(--qe-dark-surface);
    color: var(--qe-dark-text);

    span {
      color: var(--qe-dark-text);
    }

    .modal-desc {
      color: var(--qe-dark-text-muted);
    }

    .modal-subtitle {
      border-bottom-color: var(--qe-dark-border);
    }

    .modal-servers li {
      border-color: var(--qe-dark-border);
      color: var(--qe-dark-text);

      &.active {
        border-color: var(--qe-dark-link);
        background: rgba(108, 182, 255, 0.1);

        i {
          color: var(--qe-dark-link);
        }
      }

      i {
        color: var(--qe-dark-border);
      }

      select,
      input {
        background-color: var(--qe-dark-code-bg);
        color: var(--qe-dark-text);
        border: 1px solid var(--qe-dark-border);
      }
    }

    .launch a {
      background: var(--qe-dark-accent);
      color: #fff;

      &:hover {
        background: var(--qe-dark-accent-dark);
      }
    }
  }

  // =========================================
  // SEARCH RESULTS
  // =========================================
  .bd-search-container ul.search li div.context,
  .bd-search-container ul.search li p.context {
    color: var(--qe-dark-text);
  }

  // =========================================
  // HOMEPAGE / QUANTECON DEFAULTS
  // =========================================
  .web-version a {
    color: var(--qe-dark-text);
    border-color: var(--qe-dark-border);

    &:hover {
      background: var(--qe-dark-surface-alt);
      border-color: var(--qe-dark-link);
      color: var(--qe-dark-heading);

      p {
        color: var(--qe-dark-text-light);
      }
    }

    .thumb {
      color: var(--qe-dark-text);
    }

    p {
      color: var(--qe-dark-text-muted);
    }
  }

  .home-alternatives li a {
    color: var(--qe-dark-text);
    border-color: var(--qe-dark-border);

    &:hover {
      background: var(--qe-dark-surface-alt);
      border-color: var(--qe-dark-link);
      color: var(--qe-dark-heading);

      svg {
        color: var(--qe-dark-heading);
      }

      p {
        color: var(--qe-dark-text-light);
      }
    }

    svg {
      color: var(--qe-dark-text);
    }

    h3 {
      color: var(--qe-dark-heading);
    }

    p {
      color: var(--qe-dark-text-muted);
    }
  }

  // =========================================
  // AUTODOC / API DOCUMENTATION
  // =========================================
  dl.py {
    dt {
      background-color: var(--qe-dark-surface);
      border-color: var(--qe-dark-border);
    }
  }

  .viewcode-link {
    color: #50b880;
  }

  // =========================================
  // DROPDOWN TOGGLE BUTTONS
  // =========================================
  details.toggle-details {
    border-color: var(--qe-dark-border);

    summary {
      background-color: var(--qe-dark-surface);
      color: var(--qe-dark-text);
    }
  }

  // =========================================
  // FOOTNOTES
  // =========================================
  .footnote-reference {
    color: var(--qe-dark-link);
  }

  dl.footnote dt {
    color: var(--qe-dark-text);
  }
}
