{%- extends "pydata_sphinx_theme/layout.html" %}

{% block css %}
<script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
{% if mathjax_version == 3 %}
<script>
    MathJax = {
        loader: { load: ['[tex]/boldsymbol', '[tex]/textmacros'] },
        tex: {
            packages: { '[+]': ['boldsymbol', 'textmacros'] },
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            processEscapes: true,
            macros: {
                "argmax": "arg\\,max",
                "argmin": "arg\\,min",
                "col": "col",
                "Span": "span",
                "epsilon": "\\varepsilon",
                "EE": "\\mathbb{E}",
                "PP": "\\mathbb{P}",
                "RR": "\\mathbb{R}",
                "NN": "\\mathbb{N}",
                "ZZ": "\\mathbb{Z}",
                "aA": "\\mathcal{A}",
                "bB": "\\mathcal{B}",
                "cC": "\\mathcal{C}",
                "dD": "\\mathcal{D}",
                "eE": "\\mathcal{E}",
                "fF": "\\mathcal{F}",
                "gG": "\\mathcal{G}",
                "hH": "\\mathcal{H}",
            }
        },
        svg: {
            fontCache: 'global',
            scale: 0.92,
            displayAlign: "center",
        },
    };
</script>
{% endif %}
{{ super() }}
{% endblock %}
{% block extrahead %}

<!-- Normal Meta Tags -->
<meta name="author" context="{{ author | e }}" />
<meta name="keywords" content="{{ theme_keywords | e }}" />
<meta name="description" content="{{ theme_description | e }}" />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@{{ theme_twitter | e }}" />
<meta name="twitter:title" content="{% if pagetitle %}{{ pagetitle | e }}{% else %}{{ title | e }}{% endif %}" />
<meta name="twitter:description" content="{{ theme_description | e }}">
<meta name="twitter:creator" content="@{{ theme_twitter | e }}">
<meta name="twitter:image" content="{{ theme_twitter_logo_url | e }}">

<!-- Opengraph tags -->
<meta property="og:title" content="{% if pagetitle %}{{ pagetitle | e }}{% else %}{{ docstitle | e }}{% endif %}" />
<meta property="og:type" content="website" />
<meta property="og:url" content="{{ pageurl | e }}" />
<meta property="og:image" content="{{ theme_og_logo_url | e }}" />
<meta property="og:description" content="{{ theme_description | e }}" />
<meta property="og:site_name" content="{{ docstitle | e }}" />
<meta name="theme-color" content="#ffffff" />
{% endblock %}

{# Silence the sidebar's, relbar's #}
{% block header %}{% endblock %}
{% block relbar1 %}{% endblock %}
{% block relbar2 %}{% endblock %}
{% block sidebarsourcelink %}{% endblock %}

{% block body_tag %}
<body{% if master_doc==pagename %} class="main-index" {% endif %}>
    {%- endblock %}
    {%- block content %}


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id={{pagename}}>

                <div class="qe-page__toc">

                    <div class="inner">

                        {% set page_toc = generate_toc_html() %}

                        {%- if page_toc | length >= 1 %}
                        <div class="qe-page__toc-header">
                            导航
                        </div>
                        {%- endif %}


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            {{ page_toc }}
                            <p class="logo">
                                {% if logo %}
                                {% if theme_header_organisation_url %}
                                <a href={{theme_header_organisation_url}}><img src="{{ pathto('_static/' + logo, 1) }}"
                                        class="logo logo-img" alt="logo"></a>
                                {% if theme_dark_logo %}
                                <a href={{theme_header_organisation_url}}><img
                                        src="{{ pathto('_static/' + theme_dark_logo, 1) }}" class="dark-logo-img"
                                        alt="logo"></a>
                                {% endif %}
                                {% else %}
                                <a href="{{ master_url }}"><img src="{{ pathto('_static/' + logo, 1) }}" class="logo"
                                        alt="logo"></a>
                                {% endif %}
                                {% endif %}
                            </p>
                        </nav>

                        <div class="qe-page__toc-footer">
                            {# prev/next buttons #}
                            {% macro prev_next(prev, next, prev_title='', next_title='') %}
                            {%- if next %}
                            <p><a class='right-next' id="next-link" href="{{ next.link|e }}"
                                    title="{{ _('next page')}}"><strong>下一个</strong><br>
                                    {{ next_title or next.title }}</a></p>
                            {%- endif %}
                            {%- if prev %}
                            <p><a class='left-prev' id="prev-link" href="{{ prev.link|e }}"
                                    title="{{ _('previous page')}}"><strong>上一个</strong><br>
                                    {{ prev_title or prev.title }}</a></p>
                            {%- endif %}
                            {% endmacro %}
                            <p><a href="#top"><strong>↑ 返回顶部</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="{{ master_url }}">{{ docstitle | e }}</a></p>

                        <p class="qe-page__header-subheading">{{ pagetitle | e }}</p>

                    </div>

                    <p class="qe-page__header-authors">{{ author }}</p>

                </div> <!-- .page__header -->



                {% block docs_main %}
                <main class="qe-page__content" role="main">
                    {% block docs_body %}
                    <div>
                        {% block body %} {% endblock %}
                    </div>
                    {% endblock %}
                </main> <!-- .page__content -->
                {% endblock %}


                <footer class="qe-page__footer">
                    <p xmlns:cc="http://creativecommons.org/ns#">该作品由 {{ author }} 创作，基于 <a
                            href="https://creativecommons.org/licenses/by-nd/4.0/deed.zh-hans" target="_blank"
                            rel="license noopener noreferrer" style="display:inline-block;">署名-禁止演绎 4.0</a> 授权协议许可，请严格遵循。
                    </p>
                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            {% block docs_sidebar %}

            {% if theme_persistent_sidebar is defined and theme_persistent_sidebar is sameas true %}
            <div class="qe-sidebar bd-sidebar inactive persistent" id="site-navigation">
                {%- else %}
                <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">
                    {%- endif %}

                    <div class="qe-sidebar__header">
                        目录
                    </div>

                    <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                        {{ sbt_generate_toctree_html(include_item_names=False, with_home_page=theme_home_page_in_toc) }}
                    </nav>

                    <div class="qe-sidebar__footer">

                    </div>

                </div> <!-- .sidebar -->
                {% endblock %}
            </div> <!-- .main -->

            <div class="qe-toolbar">

                <div class="qe-toolbar__inner">

                    <ul class="qe-toolbar__main">
                        <li data-tippy-content="目录" class="btn__sidebar"><i data-feather="menu"></i></li>
                        <li><a href="{{ master_url }}"><span>{{ theme_header_organisation}}</span></a></li>
                    </ul>

                    <ul class="qe-toolbar__links">
                        <li class="btn__search">
                            <form action="{{ pathto('search') }}" method="get">
                                <input type="search" class="form-control" name="q" id="search-input"
                                    placeholder="{{ theme_search_bar_text }}" aria-label="{{ theme_search_bar_text }}"
                                    autocomplete="off" accesskey="k">
                                <i data-feather="search" id="search-icon"></i>
                            </form>
                        </li>
                        <li data-tippy-content="全屏" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                        <li data-tippy-content="增加字体大小" class="btn__plus"><i data-feather="plus-circle"></i>
                        </li>
                        <li data-tippy-content="减小字体大小" class="btn__minus"><i
                                data-feather="minus-circle"></i></li>
                        <li data-tippy-content="深色模式" class="btn__contrast"><i data-feather="sunset"></i>
                        </li>
                    </ul>

                </div>

            </div> <!-- .toolbar -->
            <div id="downloadPDFModal" style="display: none;">
                <ul class="pdf-options" style="display: block;">
                    <li class="download-pdf-book" onClick="window.print()">
                        <p>Lecture (PDF)</p>
                    </li>
                    <li class="download-pdf-file">
                        <a href="{{ pdf_book_path }}" download>
                            <p>Book (PDF)</p>
                        </a>
                    </li>
                </ul>
            </div>
            <div id="settingsModal" style="display: none;">
                <p class="modal-title"> Notebook Launcher </p>
                <div class="modal-desc">
                    <p>
                        Choose public or private cloud service for "Launch" button.
                    </p>
                </div>
                <p class="modal-subtitle">Select a server</p>
                <ul class="modal-servers">
                    <li class="active launcher-public">
                        <span class="label">Public</span>
                        <select id="launcher-public-input">
                            {% for item in launch_buttons%}
                            <option value="{{item.url}}">{{item.name}}</option>
                            {% endfor %}
                        </select>
                        <i class="fas fa-check-circle"></i>
                    </li>
                    <li class="launcher-private">
                        <span class="label">Private</span>
                        <input type="text" id="launcher-private-input" data-repourl="{{theme_nb_repository_url}}"
                            data-urlpath="{{jupyterhub_urlpath}}" data-branch={{repo_branch}}>
                        <i class="fas fa-check-circle"></i>
                    </li>
                </ul>
                <p class="launch"><a href="{{default_server}}" id="advancedLaunchButton" target="_blank">Launch
                        Notebook</a></p>
                <script>
                    // QuantEcon Notebook Launcher
                    const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                    // Highlight the server type if previous selection exists
                    if (typeof localStorage.launcherType !== 'undefined') {
                        for (var i = 0; i < launcherTypeElements.length; i++) {
                            launcherTypeElements[i].classList.remove('active');
                            if (launcherTypeElements[i].classList.contains(localStorage.launcherType)) {
                                launcherTypeElements[i].classList.add('active');
                            }
                        }
                    }
                    // Highlight server type on click and set local storage value
                    for (var i = 0; i < launcherTypeElements.length; i++) {
                        launcherTypeElements[i].addEventListener('click', function () {
                            for (var j = 0; j < launcherTypeElements.length; j++) {
                                launcherTypeElements[j].classList.remove('active');
                            }
                            this.classList.add('active');
                            if (this.classList.contains('launcher-private')) {
                                localStorage.launcherType = 'launcher-private';
                            } else if (this.classList.contains('launcher-public')) {
                                localStorage.launcherType = 'launcher-public';
                            }
                            setLaunchServer();
                        })
                    }
                    const launcherPublic = document.getElementById('launcher-public-input');
                    const launcherPrivate = document.getElementById('launcher-private-input');
                    const pageName = "{{pagename}}";
                    const repoURL = "{{theme_nb_repository_url}}";
                    const urlPath = "{{jupyterhub_urlpath}}";
                    const branch = "{{repo_branch}}"
                    const launchNotebookLink = document.getElementById('advancedLaunchButton');

                    // Highlight public server option if previous selection exists
                    if (typeof localStorage.launcherPublic !== 'undefined') {
                        launcherPublic.value = localStorage.launcherPublic;
                    }
                    // Update local storage upon public server selection
                    launcherPublic.addEventListener('change', (event) => {
                        setLaunchServer();
                    });
                    // Populate private server input if previous entry exists
                    if (typeof localStorage.launcherPrivate !== 'undefined') {
                        launcherPrivate.value = localStorage.launcherPrivate;
                    }
                    // Update local storage when a private server is entered
                    launcherPrivate.addEventListener('input', (event) => {
                        setLaunchServer();
                    });

                    // Function to update the "Launch Notebook" link href
                    function setLaunchServer() {
                        launchNotebookLink.removeAttribute("style")
                        if (localStorage.launcherType == 'launcher-private') {
                            let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                            launcherPrivateValue = launcherPrivate.value
                            if (!launcherPrivateValue) {
                                launchNotebookLink.removeAttribute("href")
                                launchNotebookLink.style.background = "grey"
                                return
                            }
                            localStorage.launcherPrivate = launcherPrivateValue;
                            privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                            if (!privateServer.includes("http")) {
                                privateServer = "http://" + privateServer
                            }
                            launchNotebookLinkURL = privateServer + repoPrefix;
                        } else if (localStorage.launcherType == 'launcher-public') {
                            launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                            localStorage.launcherPublic = launcherPublicValue;
                            launchNotebookLinkURL = localStorage.launcherPublic;
                        }
                        if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                    }
                    // Check if user has previously selected a server
                    if ((typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined')) {
                        setLaunchServer();
                    }
                </script>

            </div>

        </div> <!-- .wrapper-->
        {%- block scripts_end %}
        {%- endblock %}
        {%- endblock %}

        {% block docs_toc %}
        {% endblock %}

        {%- block footer %}
        {%- endblock %}
